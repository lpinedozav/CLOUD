@page
@model CLOUD.Pages.DevolverModel
@{
    ViewData["Title"] = "Devolver libro";
}
<main class="contenedor">
    <h2>Devolver libro</h2>

    <label for="id_libro">Ingrese el ID del libro:</label>
    <input type="text" id="id_libro" name="id_libro">
    <input type="submit" value="Verificar préstamo" onclick="verificarPrestamo()">

    <div id="resultado" class="info-prestamo" style="margin-top:20px;background:#f0f8ff;padding:10px;border-radius:6px;display:none;"></div>
</main>
<script>
    function verificarPrestamo() {
        const idLibro = document.getElementById('id_libro').value.trim();
        if (idLibro === '') {
            alert('Por favor, ingresa el ID del libro.');
            return;
        }

        fetch(`http://TU_IP_EC2/verificar_prestamo.php?id_libro=${idLibro}`)
            .then(res => res.json())
            .then(data => {
                const div = document.getElementById('resultado');
                if (!data.encontrado) {
                    div.innerHTML = `<p><strong>${data.mensaje}</strong></p>`;
                    div.style.display = 'block';
                    return;
                }

                div.innerHTML = `
                    <p><strong>Libro:</strong> ${data.nombre_libro}</p>
                    <p><strong>Prestado a:</strong> ${data.run_usuario}</p>
                    <p><strong>Fecha préstamo:</strong> ${data.fecha_prestamo}</p>
                    <p><strong>Fecha devolución:</strong> ${data.fecha_devolucion}</p>
                    <form method="POST" action="http://TU_IP_EC2/devolver_libro.php">
                        <input type="hidden" name="id_libro" value="${idLibro}">
                        <input type="submit" value="Confirmar devolución">
                    </form>
                `;
                div.style.display = 'block';
            })
            .catch(() => {
                alert('Ocurrió un error al consultar el préstamo.');
            });
    }
</script>
<style>
    .contenedor {
        max-width: 600px;
        margin: 20px auto;
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }

    label {
        font-weight: bold;
        display: block;
        margin-top: 15px;
    }

    input[type="text"], input[type="submit"] {
        width: 100%;
        padding: 10px;
        margin-top: 5px;
        border: 1px solid #ccc;
        border-radius: 6px;
    }

    input[type="submit"] {
        background-color: #0074cc;
        color: white;
        border: none;
        cursor: pointer;
    }

        input[type="submit"]:hover {
            background-color: #005da3;
        }

    .info-prestamo {
        margin-top: 20px;
        background: #f0f8ff;
        padding: 10px;
        border-radius: 6px;
        display: none;
    }
</style>
